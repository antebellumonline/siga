<!-- templates/alunos/aluno_list.html -->

{% extends 'base.html' %}

{% block title %}SIGA - Lista de Alunos{% endblock %}

{% block content %}
<h2 class="page-title">Lista de Alunos</h2>
<div class="container">

    <!-- Formulário de busca e filtro -->
    <form method="GET" action="{% url 'aluno_list' %}" class="search-form row g-3 mb-4">
        <div class="col-md-4">
            <input type="text" name="q" placeholder="Buscar por nome" value="{{ request.GET.q }}" class="form-control">
        </div>
        <div class="col-md-4">
            <input type="text" name="cidade" placeholder="Filtrar por cidade" value="{{ request.GET.cidade }}" class="form-control">
        </div>
        <div class="col-md-2 d-flex align-items-center">
            <label class="form-check-label">
                <input type="checkbox" name="inativo" value="True" class="form-check-input" {% if request.GET.inativo %}checked{% endif %}>
                Mostrar inativos
            </label>
        </div>
        <div class="col-md-2 d-flex justify-content-end">
            <button type="submit" class="btn btn-primary">Buscar</button>
            <a href="{% url 'aluno_list' %}" class="btn btn-secondary ms-2">Limpar Filtros</a>
        </div>
    </form>

    <!-- Botão para criar um novo aluno -->
    <div class="mb-3">
        <a href="{% url 'aluno_create' %}" class="btn btn-success">Novo Aluno</a>
    </div>

    <!-- Tabela de alunos -->
    <table class="table table-striped table-bordered alunos-table">
        <thead class="table-dark">
            <tr>
                <th>
                    <a href="?order_by=uid{% if request.GET.descending %}&descending=False{% else %}&descending=True{% endif %}&q={{ request.GET.q }}&cidade={{ request.GET.cidade }}&inativo={{ request.GET.inativo }}">
                        UID {% if request.GET.order_by == 'uid' %}{% if request.GET.descending %}▼{% else %}▲{% endif %}{% endif %}
                    </a>
                </th>
                <th>
                    <a href="?order_by=nome{% if request.GET.descending %}&descending=False{% else %}&descending=True{% endif %}&q={{ request.GET.q }}&cidade={{ request.GET.cidade }}&inativo={{ request.GET.ativo }}">
                        Nome {% if request.GET.order_by == 'nome' %}{% if request.GET.descending %}▼{% else %}▲{% endif %}{% endif %}
                    </a>
                </th>
                <th>CPF</th>
                <th>Cidade</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for aluno in alunos %}
            <tr>
                <td>{{ aluno.uid }}</td>
                <td><a href="{% url 'aluno_detail' aluno.pk %}">{{ aluno.nome }}</a></td>
                <td>{{ aluno.cpf }}</td>
                <td>{{ aluno.cidade }}</td>
                <td>{{ aluno.inativo|yesno:"Inativo,Ativo" }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">Nenhum aluno encontrado.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
