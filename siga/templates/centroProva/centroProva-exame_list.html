<!-- templates/centroProva/centroProva-exame_list.html -->

{% extends 'base.html' %}

{% block title %}SIGA - Exames Realizados no Centro de Provas{% endblock %}

{% block content %}

<h2 class="page-title">Exames Realizados no Centro de Provas</h2>
<!-- Formulário de busca e filtro -->
<form method="GET" action="{% url 'exame_list' %}" class="search-form">
    <div class="form-group-search">
        <div class="form-group-search-sub">
            <input type="checkbox" id="enable-search-aluno" onchange="toggleField('search-aluno')">
            <label for="search-aluno">UID ou Nome do Aluno:</label>
            <input type="text" id="search-aluno" name="q" placeholder="Busque por UID ou Nome do Aluno" value="{{ request.GET.q }}" class="form-control" aria-label="Busque por UID ou Nome do Aluno">
        </div>
        <div class="form-group-search-sub">
            <input type="checkbox" id="enable-search-daterange" onchange="toggleField('daterange')">
            <label for="search-daterange">Período de realização:</label>
            <input type="text" id="daterange" name="daterange" class="form-control" placeholder="Selecione o período" value="">
        </div>
        <div class="form-group-search-sub">
            <input type="checkbox" id="enable-search-centroProva" onchange="toggleField('select-centroProva')">
            <label for="search-centroProva">Centro de Provas:</label>
            <select name="centroProva" id="select-centroProva" class="select-search">
                <option value="">Selecione o Centro de Provas</option>
                {% for centroProva in centroProva %}
                <option value="{{ centroProva.id }}" {% if request.GET.centroProva == centroProva.id %}selected{% endif %}>
                    {{ centroProva.nome }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group-search-sub">
            <input type="checkbox" id="enable-search-certificacao" onchange="toggleField('select-certificacao')">
            <label for="search-certificacao">Certificação:</label>
            <select name="certificacao" id="select-certificacao" class="select-search">
                <option value="">Selecionar Certificação</option>
                {% for certificacao in certificacao %}
                <option value="{{ certificacao.id }}" {% if request.GET.certificacao == certificacao.id %}selected{% endif %}>
                    {{ certificacao.descricao }} ({{ certificacao.siglaExame }})
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="select-group-search">
            <input type="checkbox" id="enable-presenca" onchange="toggleField('presenca')">
            <label for="presenca">Presença:</label>
            <select name="presenca" id="presenca">
                <option value="">---</option>
                <option value="True" {% if request.GET.presenca == 'True' %}selected{% endif %}>Sim</option>
                <option value="False" {% if request.GET.presenca == 'False' %}selected{% endif %}>Não</option>
            </select>
            <input type="checkbox" id="enable-cancelado" onchange="toggleField('cancelado')">
            <label for="cancelado">Cancelado:</label>
            <select name="cancelado" id="cancelado">
                <option value="">---</option>
                <option value="True" {% if request.GET.cancelado == 'True' %}selected{% endif %}>Sim</option>
                <option value="False" {% if request.GET.cancelado == 'False' %}selected{% endif %}>Não</option>
            </select>
        </div> 
    </div>
    <!-- Botões de Ação -->
    <div class="btn-group-search">
        <button type="submit" class="btn-list">Buscar</button>
        <a class="btn-clear" href="{% url 'exame_list' %}">Limpar Busca</a>
    </div>
</form>
<!-- Grupo de botões (Novo e Retornar) -->
<div class="btn-group">
    <a class="btn-return" href="{% url 'centroProva_home' %}">Retornar</a>
    <a class="btn-new" href="{% url 'exame_new' %}">Novo</a>
</div>
<!-- Seletor para escolher quantos registros exibir -->
{% include "includes/records_per_page_selector.html" with action_url=request.path %}
<!-- Paginação da Tabela -->
<div class="pagination-search">
    <span class="step-links">
        {% if centroProva_exame.has_previous %}
            <a class="btn-first-circle" href="?page=1&records_per_page={{ request.GET.records_per_page }}&aluno={{ request.GET.aluno }}&data={{ request.GET.data }}&centroProva={{ request.GET.centroProva }}&certificacao={{ request.GET.certificacao }}&presenca={{ request.GET.presenca }}&cancelado={{ request.GET.cancelado }}" title="Primeira Página"></a>
            <a class="btn-previous-circle" href="?page={{ centroProva_exame.previous_page_number }}&records_per_page={{ request.GET.records_per_page }}&aluno={{ request.GET.aluno }}&data={{ request.GET.data }}&centroProva={{ request.GET.centroProva }}&certificacao={{ request.GET.certificacao }}&presenca={{ request.GET.presenca }}&cancelado={{ request.GET.cancelado }}" title="Página Anterior"></a>
        {% endif %}

        <span class="current">
            Página {{ centroProva_exame.number }} de {{ centroProva_exame.paginator.num_pages }}.
        </span>

        {% if centroProva_exame.has_next %}
            <a class="btn-next-circle" href="?page={{ centroProva_exame.next_page_number }}&records_per_page={{ request.GET.records_per_page }}&aluno={{ request.GET.aluno }}&data={{ request.GET.data }}&centroProva={{ request.GET.centroProva }}&certificacao={{ request.GET.certificacao }}&presenca={{ request.GET.presenca }}&cancelado={{ request.GET.cancelado }}" title="Próxima Página"></a>
            <a class="btn-last-circle" href="?page={{ centroProva_exame.paginator.num_pages }}&records_per_page={{ request.GET.records_per_page }}&aluno={{ request.GET.aluno }}&data={{ request.GET.data }}&centroProva={{ request.GET.centroProva }}&certificacao={{ request.GET.certificacao }}&presenca={{ request.GET.presenca }}&cancelado={{ request.GET.cancelado }}" title="Última Página"></a>
        {% endif %}
    </span>
</div>
<!-- Tabela de busca -->
<table class="tb-list" id="tb-list-centroProva-exames">
    <thead>
        <tr>
            <th>
                <a href="?order_by=data&descending={% if request.GET.order_by == 'data' and not request.GET.descending == 'True' %}True{% else %}False{% endif %}&aluno={{ request.GET.aluno }}&data={{ request.GET.data }}&centroProva={{ request.GET.centroProva }}&certificacao={{ request.GET.certificacao }}&presenca={{ request.GET.presenca }}&cancelado={{ request.GET.cancelado }}">
                    Data {% if request.GET.order_by == 'data' %}{% if request.GET.descending == 'True' %}▼{% else %}▲{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a href="?order_by=aluno__nome&descending={% if request.GET.order_by == 'aluno__nome' and not request.GET.descending == 'True' %}True{% else %}False{% endif %}&aluno={{ request.GET.aluno }}&data={{ request.GET.data }}&centroProva={{ request.GET.centroProva }}&certificacao={{ request.GET.certificacao }}&presenca={{ request.GET.presenca }}&cancelado={{ request.GET.cancelado }}">
                    Aluno {% if request.GET.order_by == 'aluno__nome' %}{% if request.GET.descending == 'True' %}▼{% else %}▲{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a href="?order_by=centroProva__nome&descending={% if request.GET.order_by == 'centroProva__nome' and not request.GET.descending == 'True' %}True{% else %}False{% endif %}&aluno={{ request.GET.aluno }}&data={{ request.GET.data }}&centroProva={{ request.GET.centroProva }}&certificacao={{ request.GET.certificacao }}&presenca={{ request.GET.presenca }}&cancelado={{ request.GET.cancelado }}">
                    Centro de Prova {% if request.GET.order_by == 'centroProva__nome' %}{% if request.GET.descending == 'True' %}▼{% else %}▲{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a href="?order_by=certificacao__nome&descending={% if request.GET.order_by == 'certificacao__nome' and not request.GET.descending == 'True' %}True{% else %}False{% endif %}&aluno={{ request.GET.aluno }}&data={{ request.GET.data }}&centroProva={{ request.GET.centroProva }}&certificacao={{ request.GET.certificacao }}&presenca={{ request.GET.presenca }}&cancelado={{ request.GET.cancelado }}">
                    Certificação {% if request.GET.order_by == 'certificacao__nome' %}{% if request.GET.descending == 'True' %}▼{% else %}▲{% endif %}{% endif %}
                </a>
            </th>
            <th>Presença</th>
            <th>Cancelado</th>
        </tr>
    </thead>
    <tbody>
        {% for exame in centroProva_exame %}
        <tr>
            <td>{{ exame.data }}</td>
            <td><a href="{% url 'exame_detail' exame.pk %}">{{ exame.aluno.nome }}</a></td>
            <td>{{ exame.centroProva.nome }}</td>
            <td>{{ exame.certificacao.descricao }} ({{ exame.certificacao.siglaExame }})</td>
            <td>{{ exame.presenca|yesno:"Sim,Não" }}</td>
            <td>{{ exame.cancelado|yesno:"Sim,Não" }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6">Nenhum exame encontrado.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<!-- Paginação da Tabela -->
<div class="pagination-search">
    <span class="step-links">
        {% if centroProva_exame.has_previous %}
            <a class="btn-first-circle" href="?page=1&records_per_page={{ request.GET.records_per_page }}&aluno={{ request.GET.aluno }}&data={{ request.GET.data }}&centroProva={{ request.GET.centroProva }}&certificacao={{ request.GET.certificacao }}&presenca={{ request.GET.presenca }}&cancelado={{ request.GET.cancelado }}" title="Primeira Página"></a>
            <a class="btn-previous-circle" href="?page={{ centroProva_exame.previous_page_number }}&records_per_page={{ request.GET.records_per_page }}&aluno={{ request.GET.aluno }}&data={{ request.GET.data }}&centroProva={{ request.GET.centroProva }}&certificacao={{ request.GET.certificacao }}&presenca={{ request.GET.presenca }}&cancelado={{ request.GET.cancelado }}" title="Página Anterior"></a>
        {% endif %}

        <span class="current">
            Página {{ centroProva_exame.number }} de {{ centroProva_exame.paginator.num_pages }}.
        </span>

        {% if centroProva_exame.has_next %}
            <a class="btn-next-circle" href="?page={{ centroProva_exame.next_page_number }}&records_per_page={{ request.GET.records_per_page }}&aluno={{ request.GET.aluno }}&data={{ request.GET.data }}&centroProva={{ request.GET.centroProva }}&certificacao={{ request.GET.certificacao }}&presenca={{ request.GET.presenca }}&cancelado={{ request.GET.cancelado }}" title="Próxima Página"></a>
            <a class="btn-last-circle" href="?page={{ centroProva_exame.paginator.num_pages }}&records_per_page={{ request.GET.records_per_page }}&aluno={{ request.GET.aluno }}&data={{ request.GET.data }}&centroProva={{ request.GET.centroProva }}&certificacao={{ request.GET.certificacao }}&presenca={{ request.GET.presenca }}&cancelado={{ request.GET.cancelado }}" title="Última Página"></a>
        {% endif %}
    </span>
</div>
<!-- Grupo de botões (Novo e Retornar) -->
<div class="btn-group">
    <a class="btn-return" href="{% url 'centroProva_home' %}">Retornar</a>
    <a class="btn-new" href="{% url 'exame_new' %}">Novo</a>
</div>

{% endblock %}
